"use strict";(self.webpackChunkkims_frontend=self.webpackChunkkims_frontend||[]).push([[66],{1108:(e,t,s)=>{s.d(t,{A:()=>d});var a=s(5043),l=s(249),n=s(579);class i extends a.Component{constructor(e){super(e),this.handleChange=e=>{this.setState({selectedValue:e}),this.props.onUpdateSelectedValue(e)},this.state={selectedValue:this.props.selectedValue||(this.props.isMulti?[]:"")}}componentDidUpdate(e){e.selectedValue!==this.props.selectedValue&&this.setState({selectedValue:this.props.selectedValue||(this.props.isMulti?[]:"")})}render(){const{selectedValue:e}=this.state,{data:t,placeholder:s,width:a,placeholderColor:i,menuPlacement:d,isMulti:c}=this.props;return(0,n.jsx)("div",{className:"DropDownList m-1 "+(a?`w-${a}`:""),children:(0,n.jsx)(l.Ay,{className:"dropdown",placeholder:s,value:e,options:t,onChange:this.handleChange,isMulti:c,isClearable:!0,styles:{control:e=>({...e,cursor:"pointer"}),placeholder:e=>({...e,color:i||"#6c757d"}),menu:e=>({...e,overflow:"hidden"}),menuList:e=>({...e,maxHeight:200,overflowY:"auto"})},menuPlacement:d||"auto"})})}}const d=i},6156:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(5043),l=s(214);function n(){const[e,t]=(0,a.useState)([]);return(0,a.useEffect)((()=>{(async()=>{try{const{data:e}=await l.A.get("/categories");t(e.categories)}catch(e){console.log(e)}})()}),[]),e}},9429:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var a=s(5043),l=s(214),n=s(1036),i=s(6156);function d(){const[e,t]=(0,a.useState)([]);return(0,a.useEffect)((()=>{(async()=>{try{const{data:e}=await l.A.get("/recipes");t(e.recipes)}catch(e){console.log(e)}})()}),[]),e}var c=s(579);const o=e=>{let{ReleasedItem:t,onClose:s,id:i}=e;const[d,o]=(0,a.useState)(!0),[r,u]=(0,a.useState)({});(0,a.useEffect)((()=>{if(t&&t.length>0){const e=t.reduce(((e,t)=>(e[t.id]=t.actualQty||"",e)),{});u(e)}}),[t]);return(0,c.jsx)("div",{className:"modal "+(d?"d-block":"d-none"),children:(0,c.jsx)("div",{className:"modal-dialog",role:"document",children:(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsx)("div",{className:"modal-header",children:(0,c.jsx)("h5",{className:"modal-title",children:"Edit Consumption"})}),(0,c.jsx)("div",{className:"modal-body",children:(null===t||void 0===t?void 0:t.length)>0&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("table",{className:"table table-bordered table-striped",children:[(0,c.jsx)("thead",{className:"bg-dark text-white",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Item Name"}),(0,c.jsx)("th",{children:"Reference Qty"}),(0,c.jsx)("th",{children:"Actual Qty"}),(0,c.jsx)("th",{children:"UOM"})]})}),(0,c.jsx)("tbody",{children:t.map((e=>{var t;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:(null===(t=e.Item)||void 0===t?void 0:t.itemname)||e.id}),(0,c.jsx)("td",{children:e.referenceQty}),(0,c.jsx)("td",{children:(0,c.jsx)("input",{type:"number",className:"form-control",value:r[e.id]||"",onChange:t=>{return s=e.id,a=t.target.value,void u((e=>({...e,[s]:a})));var s,a}})}),(0,c.jsx)("td",{children:e.uomname})]},e.id)}))})]}),(0,c.jsxs)("div",{className:"d-flex justify-content-end",children:[(0,c.jsx)("button",{className:"btn btn-secondary",onClick:async()=>{const e=(t||[]).map((e=>({item_Id:e.id,actualQty:r[e.id]||e.actualQty})));if(0===e.length)return void n.oR.warning("No items to update.");console.log(`the released item whose id i want is ${JSON.stringify(t)}`);const s=t.id;console.log(`The released item ID is ${s}`);try{console.log(`the items for update  is ${JSON.stringify(e)}`);const t=await l.A.put(`/updateQty/${i}`,{items:e});console.log("Items successfully updated:",t.data),t.data.success&&(n.oR.success("Items successfully updated!"),u({}))}catch(a){n.oR.error("Failed to update quantities..."),console.error("Error updating quantities:",a)}},children:"Update"}),(0,c.jsx)("button",{className:"btn btn-danger",onClick:()=>{o(!1),s&&s()},children:"Cancel"})]})]})})]})})})},r=e=>{let{data:t}=e;const[s,n]=(0,a.useState)(null),[i,d]=(0,a.useState)(Number),r={Breakfast:1,Launch:2,Dinner:3},u=[...t].sort(((e,t)=>r[e.RecipeCategory.category]-r[t.RecipeCategory.category]));return(0,c.jsxs)("div",{className:"container "+(s?"modal-active":""),children:[u.map((e=>(0,c.jsxs)("div",{className:"card mb-4 shadow-sm",children:[(0,c.jsxs)("div",{className:"card-header bg-primary text-white d-flex justify-content-between align-items-center",children:[(0,c.jsxs)("h5",{className:"mb-0",children:[e.RecipeCategory.category," - ",e.Recipe.recipe_name]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("button",{className:"btn btn-warning btn-sm me-2 bi bi-pencil-fill",onClick:()=>(e=>{n(e),d(e.id),console.log(`the recipe going to edit is  ${JSON.stringify(e)}`)})(e)}),(0,c.jsx)("button",{className:"btn btn-danger btn-sm bi bi-trash-fill",onClick:()=>(async(e,t,s)=>{if(window.confirm("Are you sure you want to delete this recipe?"))try{const a=await l.A.delete(`/daily-consumption/${e}/${t}/${s}`);alert(a.data.message),window.location.reload()}catch(a){console.error("Error deleting recipe:",a),alert("Failed to delete the recipe.")}})(e.dateId,e.categoryId,e.recipeId)})]})]}),(0,c.jsx)("div",{className:"card-body",children:(0,c.jsxs)("table",{className:"table table-striped table-hover mb-0",children:[(0,c.jsx)("thead",{className:"table-dark",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Item Name (UOM)"}),(0,c.jsx)("th",{children:"Reference Quantity"}),(0,c.jsx)("th",{children:"Actual Quantity"})]})}),(0,c.jsx)("tbody",{children:e.ReleasedItems.map((e=>(0,c.jsxs)("tr",{children:[(0,c.jsxs)("td",{children:[e.Item.itemname," (",e.uomname,")"]}),(0,c.jsx)("td",{children:e.referenceQty}),(0,c.jsx)("td",{children:e.actualQty})]},e.id)))})]})})]},e.id))),s&&(0,c.jsx)(o,{ReleasedItem:s.ReleasedItems,onClose:()=>{n(null)},id:i})]})};var u=s(6726);s(6097);const m=e=>{let{consumptionDays:t,onDateSelect:s}=e;const[l,n]=(0,a.useState)(new Date);return(0,c.jsx)("div",{children:(0,c.jsx)(u.Ay,{onChange:e=>{const t=new Date(e.getTime()-6e4*e.getTimezoneOffset());n(t),s&&(s(t),console.log(`The selected date in the React component: ${t.toISOString().split("T")[0]}`))},value:l,tileClassName:e=>{let{date:s}=e;const a=s.toLocaleDateString("en-CA");return null!==t&&void 0!==t&&t.some((e=>a===e.date.split("T")[0]))?"highlight":""}})})};var h=s(1108),p=s(6178),x=s.n(p);const j=e=>{let{date:t,adultsCount:s,childrenCount:a}=e;const l=x()(t).format("MMM D, YYYY");return(0,c.jsxs)("div",{className:"bg-light d-flex justify-content-between p-2 mt-2 mb-2 rounded",children:[(0,c.jsxs)("strong",{children:["Date: ",l]}),(0,c.jsx)("br",{}),(0,c.jsxs)("strong",{children:["Adults: ",s]}),(0,c.jsx)("br",{}),(0,c.jsxs)("strong",{children:["Children: ",a]}),(0,c.jsx)("br",{})]})},g=()=>{const[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)(null),[u,p]=(0,a.useState)([]),[x,g]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),[v,f]=(0,a.useState)(null),[N,S]=(0,a.useState)(null),[w,C]=(0,a.useState)(null),[I,A]=(0,a.useState)([]),[D,R]=(0,a.useState)({}),[k,_]=(0,a.useState)(""),[$,Q]=(0,a.useState)(""),[O,V]=(0,a.useState)(),[M,E]=(0,a.useState)(""),[U,q]=(0,a.useState)(""),[T,F]=(0,a.useState)([]),J=d(),Y=(0,i.A)();(0,a.useEffect)((()=>{(async()=>{const[e]=await Promise.all([l.A.get("/consumption-days")]);t(e.data.consumptionDays),console.log(`the all the consumption days is ${e.data.consumptionDays}`)})(),L()}),[J,Y]);const L=()=>{f(J),y(Y)};(0,a.useEffect)((()=>{if(s){var t;const a=new Date(null===(t=e.find((e=>e.id===s)))||void 0===t?void 0:t.date);a&&P(a)}}),[s,e]);const P=async t=>{const s=e.find((e=>new Date(e.date).toISOString().split("T")[0]===t.toISOString().split("T")[0]));if(s){o(s.id),_(s.adults_count),Q(s.children_count),V(new Date(s.date).toISOString().split("T")[0]);try{const e=await l.A.get(`/allconsumption/${null===s||void 0===s?void 0:s.id}`);var a;if(!0===e.data.success)p(null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.data);else console.log("no data found"),p([])}catch{p([])}}};return(0,c.jsxs)("div",{style:{marginTop:"20vh"},className:"container",children:[(0,c.jsx)("h2",{className:"text-center",children:"Consumption page"}),(0,c.jsxs)("div",{className:"row",children:[(0,c.jsxs)("div",{className:"col-md-4",children:[(0,c.jsx)("h5",{className:"text-center",children:"Consumption Days"}),(0,c.jsx)(m,{consumptionDays:e,onDateSelect:P}),(0,c.jsx)("button",{className:"btn btn-success w-100 mt-2",onClick:()=>{g(!0)},children:"Add Recipe"})]}),(0,c.jsxs)("div",{className:"col-md-8",children:[(0,c.jsx)("h5",{className:"mb-4 text-center",children:"Daily Consumption Details"}),(0,c.jsx)(j,{date:O,adultsCount:k,childrenCount:$}),(0,c.jsx)(r,{data:u}),s&&(0,c.jsx)("div",{children:(0,c.jsx)("div",{className:"modal modal-overlay "+(x?"d-block":"d-none"),tabIndex:"-1",role:"dialog",children:(0,c.jsx)("div",{className:"modal-dialog",role:"document",children:(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsx)("div",{className:"modal-header",children:(0,c.jsx)("h5",{className:"modal-title",children:"Add Daily Consumption"})}),(0,c.jsxs)("div",{className:"modal-body",children:[(0,c.jsx)("label",{htmlFor:"CategoryId",className:"col-form-label",children:"Category"}),(0,c.jsx)(h.A,{data:b.map((e=>({id:e.id,value:e.category,label:e.category}))),placeholder:"Select Category",isMulti:!1,selectedValue:N?{id:N,value:M,label:M}:null,onUpdateSelectedValue:e=>{S((null===e||void 0===e?void 0:e.id)||null),E((null===e||void 0===e?void 0:e.value)||"")}}),(0,c.jsx)("label",{htmlFor:"RecipeId",className:"col-form-label",children:"Recipe"}),(0,c.jsx)(h.A,{data:v.map((e=>({id:e.id,value:e.recipe_name,label:e.recipe_name}))),placeholder:"Select Recipe",isMulti:!1,selectedValue:w?{id:w,value:U,label:U}:null,onUpdateSelectedValue:e=>{C((null===e||void 0===e?void 0:e.id)||null),q((null===e||void 0===e?void 0:e.value)||"")}})]}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{onClick:async()=>{try{const e=await l.A.get(`getdaily-consumption/${s}/${N}/${w}`);if(!1===e.data.success){const e=await l.A.get(`/ingredient/${w}`);A(e.data.ingredients.map((e=>({...e,actual_qty:"",editable:!0})))),F([]);const t=e.data.ingredients.reduce(((e,t)=>({...e,[t.id]:""})),{});R(t)}else!0===e.data.success&&alert("data already exist")}catch(e){console.error("Error fetching data:",e)}},className:"btn btn-primary mt-2",children:"Fetch Ingredients"}),(0,c.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>g(!1),children:"Close"}),I.length>0&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("table",{className:"table table-bordered table-striped table-responsive",children:[(0,c.jsx)("thead",{className:"bg-dark text-white",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Item Name"}),(0,c.jsx)("th",{children:"Reference Qty"}),(0,c.jsx)("th",{children:"Actual Qty"}),(0,c.jsx)("th",{children:"UOM"})]})}),(0,c.jsx)("tbody",{children:I.map((e=>{var t,s,a;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:(null===(t=e.Item)||void 0===t?void 0:t.itemname)||e.id}),(0,c.jsx)("td",{children:e.reference_qty}),(0,c.jsx)("td",{children:e.editable?(0,c.jsx)("input",{type:"number",className:"form-control",value:D[e.id]||"",onChange:t=>{return s=e.id,a=t.target.value,void R((e=>({...e,[s]:a})));var s,a}}):e.actual_qty}),(0,c.jsx)("td",{children:(null===(s=e.Item)||void 0===s||null===(a=s.Uom)||void 0===a?void 0:a.uomname)||e.uomname})]},e.id)}))})]}),I.some((e=>e.editable))&&(0,c.jsxs)("div",{className:"d-flex justify-content-end",children:[(0,c.jsx)("button",{className:"btn btn-success me-2",onClick:async()=>{try{const t=I.filter((e=>e.editable)).map((e=>({itemid:e.item_id,quantity:D[e.id]||0}))),a=I.filter((e=>e.editable)).map((e=>({item_Id:e.item_id,referenceQty:e.reference_qty,uomname:e.Item.Uom.uomname,actualQty:D[e.id]||0}))),i=I.filter((e=>e.editable)).map((e=>{var t,s;return{date:O,item_id:e.item_id,debit_quantity:D[e.id]||0,recipe_id:w,category_id:N,uom_id:(null===(t=e.Item)||void 0===t||null===(s=t.Uom)||void 0===s?void 0:s.id)||1}}));console.log(`the debit records going to database is ${JSON.stringify(i)}`);const d=await l.A.post("/decrease-quantity",{items:t}),c=await l.A.post("/bulk-transaction",{transactions:i});if(console.log(`the transctions while releasing items is ${JSON.stringify(c)}`),"Bulk update completed"===d.data.message){var e;await l.A.post("/createdaily-consumption",{dateId:s,categoryId:N,recipeId:w,ingredients:a});const t=await l.A.get(`/allconsumption/${s}`);p(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.data),n.oR.success("Data submitted successfully!"),g(!1),A([]),R({}),n.oR.success("Quantities decreased successfully!")}else n.oR.error("Error decreasing quantities.")}catch(t){console.error("Error submitting data:",t),n.oR.error("Failed to submit data.")}},children:"Release Item"}),(0,c.jsx)("button",{className:"btn btn-danger",onClick:()=>g(!1),children:"Cancel"})]})]})]})]})})})})]})]})]})}}}]);
//# sourceMappingURL=66.c111dcb1.chunk.js.map