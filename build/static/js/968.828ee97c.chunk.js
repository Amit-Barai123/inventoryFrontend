"use strict";(self.webpackChunkkims_frontend=self.webpackChunkkims_frontend||[]).push([[968],{1108:(e,s,t)=>{t.d(s,{A:()=>n});var a=t(5043),l=t(249),r=t(579);class o extends a.Component{constructor(e){super(e),this.handleChange=e=>{this.setState({selectedValue:e}),this.props.onUpdateSelectedValue(e)},this.state={selectedValue:this.props.selectedValue||(this.props.isMulti?[]:"")}}componentDidUpdate(e){e.selectedValue!==this.props.selectedValue&&this.setState({selectedValue:this.props.selectedValue||(this.props.isMulti?[]:"")})}render(){const{selectedValue:e}=this.state,{data:s,placeholder:t,width:a,placeholderColor:o,menuPlacement:n,isMulti:d}=this.props;return(0,r.jsx)("div",{className:"DropDownList m-1 "+(a?`w-${a}`:""),children:(0,r.jsx)(l.Ay,{className:"dropdown",placeholder:t,value:e,options:s,onChange:this.handleChange,isMulti:d,isClearable:!0,styles:{control:e=>({...e,cursor:"pointer"}),placeholder:e=>({...e,color:o||"#6c757d"}),menu:e=>({...e,overflow:"hidden"}),menuList:e=>({...e,maxHeight:200,overflowY:"auto"})},menuPlacement:n||"auto"})})}}const n=o},1968:(e,s,t)=>{t.r(s),t.d(s,{default:()=>f});var a=t(5043),l=t(2921),r=t(8087),o=t(1036),n=t(1108),d=t(579);class i extends a.Component{constructor(e){super(e),this.handleInputChange=e=>{this.setState({[e.target.name]:e.target.value})},this.handleRoleChange=e=>{this.setState({selectedRoles:e})},this.handleUpdate=async()=>{const{fetchUsers:e,onHide:s,user:t}=this.props,{name:a,username:r,email:n,password:d,selectedRoles:i}=this.state;if(!a||!r||!n||0===i.length)return void o.oR.error("All fields are required!");const c={name:a,username:r,email:n,password:d||t.password,roles:i.map((e=>e.value))};try{await l.A.updateUser(t.id,c),o.oR.success("User updated successfully"),e(),s()}catch(h){console.log(h),o.oR.error("Failed to update user.")}},this.state={name:e.user.name||"",username:e.user.username||"",email:e.user.email||"",password:e.user.password||"",selectedRoles:e.user.roles.map((s=>{const t=e.roles.find((e=>e.name===s));return t?{value:t.id,label:t.name}:null})).filter((e=>null!==e))||[]}}render(){const{show:e,onHide:s,roles:t,user:a}=this.props,{name:l,username:o,email:i,password:c,selectedRoles:h}=this.state,m=a.roles.join(", ");return(0,d.jsx)(r.A,{show:e,onHide:s,centered:!0,children:(0,d.jsxs)("div",{className:"modal-content",style:{width:"600px"},children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h5",{className:"modal-title",children:"Update User"}),(0,d.jsx)("button",{type:"button",className:"btn-close",onClick:s})]}),(0,d.jsxs)("div",{className:"modal-body",children:[(0,d.jsxs)("div",{className:"d-flex",children:[(0,d.jsxs)("div",{className:"form-group w-100",children:[(0,d.jsx)("label",{htmlFor:"name",className:"mb-2",children:"Name"}),(0,d.jsx)("input",{type:"text",className:"form-control",name:"name",id:"name",placeholder:"Enter name",value:l,onChange:this.handleInputChange,autoComplete:"off"})]}),(0,d.jsxs)("div",{className:"form-group w-100 ms-2",children:[(0,d.jsx)("label",{htmlFor:"username",className:"mb-2",children:"Username"}),(0,d.jsx)("input",{type:"text",className:"form-control",name:"username",id:"username",placeholder:"Enter username",value:o,onChange:this.handleInputChange,autoComplete:"off"})]})]}),(0,d.jsxs)("div",{className:"d-flex mt-3",children:[(0,d.jsxs)("div",{className:"form-group w-100",children:[(0,d.jsx)("label",{htmlFor:"email",className:"mb-2",children:"Email"}),(0,d.jsx)("input",{type:"email",className:"form-control",name:"email",id:"email",placeholder:"Enter email",value:i,onChange:this.handleInputChange,autoComplete:"off"})]}),(0,d.jsxs)("div",{className:"form-group w-100 ms-2",children:[(0,d.jsx)("label",{htmlFor:"password",className:"mb-2",children:"Password"}),(0,d.jsx)("input",{type:"password",className:"form-control",name:"password",id:"password",placeholder:"Enter new password (leave empty to keep current)",value:c,onChange:this.handleInputChange,autoComplete:"new-password"})]})]}),(0,d.jsxs)("div",{className:"form-group mt-3",children:[(0,d.jsxs)("label",{htmlFor:"roles",className:"mb-2",children:["Roles ",m&&`(${m})`]}),(0,d.jsx)(n.A,{name:"roles",placeholder:"Select Roles",isMulti:!0,data:t.map((e=>({value:e.id,label:e.name}))),onUpdateSelectedValue:this.handleRoleChange,selectedValue:h})]})]}),(0,d.jsxs)("div",{className:"modal-footer",children:[(0,d.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:s,children:"Cancel"}),(0,d.jsx)("button",{type:"button",className:"btn btn-primary",onClick:this.handleUpdate,children:"Update User"})]})]})})}}const c=i;class h extends a.Component{constructor(e){super(e),this.openUpdateUserModal=()=>{this.setState({showUpdateUserModal:!0})},this.closeUpdateUserModal=()=>{this.setState({showUpdateUserModal:!1})},this.state={showUpdateUserModal:!1}}render(){const{showUpdateUserModal:e}=this.state,{user:s,fetchUsers:t,roles:a}=this.props;return(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{role:"button",onClick:this.openUpdateUserModal,className:"btn btn-primary",title:"Edit User",children:(0,d.jsx)("i",{className:"bi bi-pencil-fill"})}),s&&(0,d.jsx)(c,{show:e,onHide:this.closeUpdateUserModal,user:s,fetchUsers:t,roles:a})]})}}var m=t(4282);class u extends a.Component{render(){const{show:e,onHide:s,onDelete:t,user:a}=this.props;return(0,d.jsxs)(r.A,{show:e,onHide:s,children:[(0,d.jsx)(r.A.Header,{closeButton:!0,children:(0,d.jsx)(r.A.Title,{children:"Delete User"})}),(0,d.jsxs)(r.A.Body,{children:[(0,d.jsxs)("p",{children:["Are you sure you want to delete the user ",(0,d.jsx)("strong",{children:null===a||void 0===a?void 0:a.username}),"?"]}),(0,d.jsx)("p",{children:"This action cannot be undone."})]}),(0,d.jsxs)(r.A.Footer,{children:[(0,d.jsx)(m.A,{variant:"secondary",onClick:s,children:"Cancel"}),(0,d.jsx)(m.A,{variant:"danger",onClick:t,children:"Delete"})]})]})}}class p extends a.Component{constructor(e){super(e),this.openDeleteModal=()=>{this.setState({showDeleteModal:!0})},this.closeDeleteModal=()=>{this.setState({showDeleteModal:!1})},this.handleDelete=async()=>{const{user:e,fetchUsers:s}=this.props;try{await l.A.deleteUser(e.id),o.oR.success(`User ${e.username} deleted successfully`),this.closeDeleteModal(),s()}catch(t){t.response&&t.response.data.error.includes("violates foreign key constraint")?(this.closeDeleteModal(),o.oR.error("User cannot be deleted as they are connected to other records.")):o.oR.error("Failed to delete User"),console.error(t)}},this.state={showDeleteModal:!1}}render(){const{showDeleteModal:e}=this.state,{user:s}=this.props;return(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{role:"button",className:"btn btn-danger ",title:"Delete User",onClick:this.openDeleteModal,children:(0,d.jsx)("i",{className:"bi bi-trash-fill"})}),(0,d.jsx)(u,{show:e,onHide:this.closeDeleteModal,onDelete:this.handleDelete,user:s})]})}}class x extends a.Component{constructor(e){super(e),this.state={}}render(){const{users:e,roles:s,fetchUsers:t}=this.props;return(0,d.jsx)("div",{className:"container",children:(0,d.jsx)("div",{className:"row",children:e.map((e=>(0,d.jsx)("div",{className:"col-md-4 mt-2 px-1",children:(0,d.jsx)("div",{className:"card shadow-sm h-100",children:(0,d.jsxs)("div",{className:"card-body d-flex align-items-top justify-content-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h5",{className:"card-title fw-bold mb-2",children:e.name}),(0,d.jsxs)("p",{className:"mb-1",children:[(0,d.jsx)("strong",{children:"Username:"})," ",e.username]}),(0,d.jsxs)("p",{className:"mb-1",children:[(0,d.jsx)("strong",{children:"Email:"})," ",e.email]}),(0,d.jsxs)("p",{className:"mb-0",children:[(0,d.jsx)("strong",{children:"Roles:"})," ",e.roles.join(", ")]})]}),(0,d.jsxs)("div",{className:"d-flex flex-column justify-content-between",children:[(0,d.jsx)(h,{fetchUsers:t,roles:s,user:e}),(0,d.jsx)(p,{user:e,fetchUsers:t})]})]})})},e.id)))})})}}class j extends a.Component{constructor(e){super(e),this.handleInputChange=e=>{this.setState({[e.target.name]:e.target.value})},this.handleRoleChange=e=>{this.setState({selectedRoles:e})},this.handleCreate=async()=>{const{fetchUsers:e,onHide:s}=this.props,{name:t,username:a,email:r,password:n,selectedRoles:d}=this.state;if(!t||!a||!r||!n||0===d.length)return void o.oR.error("All fields are required!");const i={name:t,username:a,email:r,password:n,roles:d.map((e=>e.value))};try{await l.A.register(i),o.oR.success("User created successfully"),this.resetForm(),e(),s()}catch(c){console.log(c),o.oR.error("Failed to create user.")}},this.resetForm=()=>{this.setState({name:"",username:"",email:"",password:"",selectedRoles:[]})},this.state={name:"",username:"",email:"",password:"",selectedRoles:[]}}render(){const{show:e,onHide:s,roles:t}=this.props,{name:a,username:l,email:o,password:i,selectedRoles:c}=this.state;return(0,d.jsx)(r.A,{show:e,onHide:s,centered:!0,children:(0,d.jsxs)("div",{className:"modal-content",style:{width:"600px"},children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h5",{className:"modal-title",children:"Create User"}),(0,d.jsx)("button",{type:"button",className:"btn-close",onClick:s})]}),(0,d.jsxs)("div",{className:"modal-body",children:[(0,d.jsxs)("div",{className:"d-flex",children:[(0,d.jsxs)("div",{className:"form-group w-100",children:[(0,d.jsx)("label",{htmlFor:"name",className:"mb-2",children:"Name"}),(0,d.jsx)("input",{type:"text",className:"form-control",name:"name",id:"name",placeholder:"Enter name",value:a,onChange:this.handleInputChange,autoComplete:"off"})]}),(0,d.jsxs)("div",{className:"form-group w-100 ms-2",children:[(0,d.jsx)("label",{htmlFor:"username",className:"mb-2",children:"Username"}),(0,d.jsx)("input",{type:"text",className:"form-control",name:"username",id:"username",placeholder:"Enter username",value:l,onChange:this.handleInputChange,autoComplete:"off"})]})]}),(0,d.jsxs)("div",{className:"form-group mt-3",children:[(0,d.jsx)("label",{htmlFor:"email",className:"mb-2",children:"Email"}),(0,d.jsx)("input",{type:"email",className:"form-control",name:"email",id:"email",placeholder:"Enter email",value:o,onChange:this.handleInputChange,autoComplete:"off"})]}),(0,d.jsxs)("div",{className:"d-flex mt-3",children:[(0,d.jsxs)("div",{className:"form-group w-100",children:[(0,d.jsx)("label",{htmlFor:"password",className:"mb-2",children:"Password"}),(0,d.jsx)("input",{type:"password",className:"form-control",name:"password",id:"password",placeholder:"Enter password",value:i,onChange:this.handleInputChange,autoComplete:"new-password"})]}),(0,d.jsxs)("div",{className:"form-group w-100 ms-1",children:[(0,d.jsx)("label",{htmlFor:"roles",className:"mb-1",children:"Roles"}),(0,d.jsx)(n.A,{name:"roles",placeholder:"Select Roles",isMulti:!0,data:t.map((e=>({value:e.id,label:e.name}))),onUpdateSelectedValue:this.handleRoleChange,selectedValue:c})]})]})]}),(0,d.jsxs)("div",{className:"modal-footer",children:[(0,d.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:s,children:"Cancel"}),(0,d.jsx)("button",{type:"button",className:"btn btn-primary",onClick:this.handleCreate,children:"Create User"})]})]})})}}const w=j;class N extends a.Component{constructor(e){super(e),this.openUserModal=()=>{this.setState({showUserModal:!0})},this.closeUserModal=()=>{this.setState({showUserModal:!1})},this.state={showUserModal:!1}}render(){const{showUserModal:e}=this.state,{fetchUsers:s,roles:t}=this.props;return(0,d.jsxs)("div",{className:"",children:[(0,d.jsx)("button",{className:"btn btn-primary",onClick:this.openUserModal,children:"Create User"}),(0,d.jsx)(w,{show:e,onHide:this.closeUserModal,fetchUsers:s,roles:t})]})}}class f extends a.Component{constructor(e){super(e),this.handleSearchChange=e=>{this.setState({search:e.target.value})},this.state={users:[],roles:[],loading:!0,search:""}}componentDidMount(){this.getAllUsers(),this.getAllRoles()}getAllUsers(){l.A.getAllUsers().then((e=>{this.setState({users:e.data.users||[],loading:!1})})).catch((e=>{console.log(e),this.setState({loading:!1,users:[]})}))}getAllRoles(){l.A.getAllRoles().then((e=>{this.setState({roles:e.data.roles||[]})})).catch((e=>{console.log(e),this.setState({roles:[]})}))}render(){const{users:e,roles:s,loading:t,search:a}=this.state,l=e.filter((e=>{var s;return null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(a.toLowerCase())}));return t?(0,d.jsx)("div",{className:"w-100 text-center mt-5",children:(0,d.jsx)("div",{className:"spinner-border",role:"status",children:(0,d.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):(0,d.jsxs)("div",{className:"container mt-100",children:[(0,d.jsx)("h2",{className:"mb-4 text-center",children:"Users List Page"}),(0,d.jsx)("div",{className:"row",children:(0,d.jsxs)("div",{className:"my-4 d-flex justify-content-between",children:[(0,d.jsx)("div",{}),(0,d.jsx)("div",{className:"col-md-6",children:(0,d.jsx)("input",{type:"text",className:"form-control",placeholder:"Search users...",value:a,onChange:this.handleSearchChange})}),(0,d.jsx)("div",{className:"",children:(0,d.jsx)(N,{fetchUsers:()=>this.getAllUsers(),roles:s})})]})}),(0,d.jsx)(x,{users:l,roles:s,fetchUsers:()=>this.getAllUsers()})]})}}}}]);
//# sourceMappingURL=968.828ee97c.chunk.js.map